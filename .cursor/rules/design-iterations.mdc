---
description: Guidelines for using the design iterations workflow for UI components
globs: ["**/*.{tsx,jsx,js,ts}", "**/*.css", "**/*.md"]
alwaysApply: false
---
# Design Iterations System

## <critical> Screenshot Verification and Context Persistence </critical>

**IMPORTANT**: Each iteration MUST have a unique, verified screenshot. To ensure this:

1. **Visual verification before capture**:
   - After making component changes, ALWAYS wait 45-60 seconds minimum
   - Manually verify in browser that changes are visible before running screenshot command
   - If changes aren't visible, restart the dev server with `pnpm start`

2. **Timestamp all artifacts**:
   - Debug HTML files should include timestamp in filename: `*-debug-{timestamp}.html`
   - Screenshot filenames must contain unique timestamps: `*-{timestamp}.png`
   - Log the timestamp in the iteration metadata for reference

3. **Diff verification**:
   - After each iteration, verify a diff was generated and is substantial
   - Check diff files in `docs/temp/design-iterations/iteration-N/diff.patch`
   - If diff is minimal, your changes may not have been captured properly

4. **Context building**:
   - Document each iteration's key design changes in feedback template
   - Reference previous iterations when describing each new design
   - Create a progression narrative between iterations
   - Tag screenshots with design approach keywords for future reference

5. **Screenshot validation**:
   - After capturing a screenshot, open and visually confirm it shows the new design
   - If screenshot shows previous design, wait longer and retry
   - Compare against previous screenshots to confirm differences

```bash
# After making changes, verify in browser, THEN capture:
pnpm docs:design-iterations:count-1 --target="03-try-jods-section" --prompt="Pink theme with gradient accents" --skip-other-sections

# Immediately verify screenshot shows new design:
open docs/static/screenshots/unified/03-try-jods-section-light-{timestamp}.png
```

## Quick Start

```bash
# Generate design iterations for a specific target only
pnpm docs:design-iterations:count-5 --target="04-framework-section-react" --prompt="Reimagine with bold visual hierarchy" --skip-other-sections
```

## <critical> Proper Workflow Sequence </critical>

**CRITICAL**: Follow this sequence exactly to ensure each iteration captures distinct designs:

1. **Modify component code** - Make your design changes to both TSX/JSX and CSS files
2. **Save changes** - Ensure all files are saved
3. **Wait for rebuild** - Allow 45-60 seconds for DocuSaurus to fully rebuild
4. **Verify changes in browser** - Manually confirm your design changes are visible
5. **Capture ONE iteration** - Run the screenshot command for just this iteration
6. **Verify screenshot** - Open and confirm the screenshot shows your new design
7. **Document context** - Add detailed notes to the feedback template
8. **Make new changes** - Create a different design for the next iteration
9. **Repeat steps 2-8** - Follow the same sequence for each iteration

```bash
# CORRECT: One iteration at a time with verification between each
# First modify component code, save, wait 45-60 seconds, verify in browser, then:
pnpm docs:design-iterations:count-1 --target="04-framework-section-react" --skip-other-sections

# After capturing, verify screenshot and document context:
open docs/static/screenshots/unified/04-framework-section-react-light-{timestamp}.png
edit docs/temp/design-iterations/iteration-N/feedback-template.md

# INCORRECT: Running multiple iterations without verification
pnpm docs:design-iterations:count-3 --target="04-framework-section-react" --skip-other-sections
```

## <required> Artifact Preservation </required>

**IMPORTANT**: Do NOT clean up design iteration artifacts until explicitly requested by the user. Artifacts are essential for:

1. **Design review** - Comparing multiple design approaches
2. **Feedback collection** - Adding notes to feedback templates
3. **Iteration refinement** - Using previous designs as reference
4. **Final application** - Selecting the best design to apply

Only run cleanup after the user has:
1. Reviewed all design iterations
2. Applied their chosen design
3. Explicitly requested cleanup with `pnpm docs:design-iterations:cleanup`

The agent CANNOT know when the user is done reviewing design iterations. Premature cleanup could cause loss of valuable information. Cleanup should ONLY happen when explicitly requested, not automatically.

## Styling Approach: Follow Component Conventions

**IMPORTANT**: Always match the existing styling conventions of the component:

1. **First analyze the component** to determine its styling approach:
   - Check imports at the top for CSS/SCSS module imports
   - Look for className references that use imported styles
   - Notice any CSS-in-JS patterns or inline styles

2. **Common styling approaches**:
   - **CSS Modules**: `import styles from './Component.module.css'` → Use `className={styles.element}`
   - **Global CSS**: `import './Component.css'` → Use `className="element"`
   - **CSS-in-JS**: Look for styled-components or emotion usage
   - **Tailwind**: Look for utility class patterns like `className="flex items-center"`

3. **Examples of following conventions**:

```tsx
// If the component uses CSS modules:
import styles from './InteractiveDemo.module.css';
// ...
<div className={styles.demoContainer}>

// If the component uses global CSS:
import './InteractiveDemo.css';
// ...
<div className="demo-container">

// If the component uses inline styles:
<div style={{ display: 'flex', gap: '1rem' }}>
```

## <required> Component Code Updates Required </required>

For each design iteration, you MUST modify the component code BEFORE taking screenshots:

1. **Step 1: Edit the component code directly** - Before generating the screenshot for each iteration, modify the component's TSX/JSX and CSS code according to the design prompt
2. **Step 2: Wait for changes to apply** - Allow sufficient time (45-60 seconds) for DocuSaurus to rebuild with the new changes
3. **Step 3: Verify in browser** - ALWAYS confirm changes are visible before proceeding
4. **Step 4: Then run the screenshot command** - Each iteration should capture a visually distinct design
5. **Step 5: Verify screenshot** - Open and confirm the screenshot shows your new design

Example workflow:
```bash
# First modify the component code (edit both TSX and CSS files if needed)
# Edit src/components/InteractiveDemo.tsx
# Edit src/components/InteractiveDemo.module.css (if the component uses CSS modules)

# After saving changes, wait 45-60 seconds, verify in browser, then run:
pnpm docs:design-iterations:count-1 --target="04-framework-section-react" --skip-other-sections

# Verify the screenshot captured your changes:
open docs/static/screenshots/unified/04-framework-section-react-light-{timestamp}.png

# Then modify the component code differently
# After saving changes, wait 45-60 seconds, verify in browser, then run:
pnpm docs:design-iterations:count-1 --target="04-framework-section-react" --skip-other-sections

# Repeat verification for each screenshot
open docs/static/screenshots/unified/04-framework-section-react-light-{timestamp}.png

# Repeat for each unique design iteration
```

## <required> Building Context Between Iterations </required>

For each iteration, maintain context by:

1. **Creating descriptive prompts**:
```bash
pnpm docs:design-iterations:count-1 --target="03-try-jods-section" --prompt="Pink theme with curved borders and gradient accents" --skip-other-sections
```

2. **Documenting changes in feedback templates**:
```markdown
# Iteration 2: Pink Theme with Gradients

## Design Approach
- Implemented a vibrant pink color scheme (#FF5CAD) with purple accents
- Added subtle gradient backgrounds transitioning from pink to purple
- Curved all container borders to 12px radius
- Applied animation to code examples on hover

## Comparison to Previous
- More vibrant and playful than Iteration 1's minimal design
- Added visual hierarchy with gradient backgrounds
- Enhanced interactive elements with hover animations

## Timestamp: 2023-11-16T14:32:15
```

3. **Enhanced metadata**:
```json
{
  "iteration": 2,
  "timestamp": "2023-11-16T14:32:15",
  "target": "03-try-jods-section",
  "design_approach": "Pink theme with gradients",
  "key_changes": ["color scheme", "gradients", "animations"],
  "screenshot_path": "docs/static/screenshots/unified/03-try-jods-section-light-20231116143215.png",
  "diff_path": "docs/temp/design-iterations/iteration-2/diff.patch",
  "debug_html_path": "docs/static/debug/03-try-jods-section-light-debug-20231116143215.html"
}
```

## <critical> Important: Component Name Formats </critical>

**CRITICAL**: Always use the numbered format for component target names in screenshot commands:

```bash
# CORRECT - Use the numbered prefix format:
pnpm docs:design-iterations:count-5 --target="04-framework-section-react" --skip-other-sections

# INCORRECT - Simple names without the numbered prefix may not work properly:
pnpm docs:design-iterations:count-5 --target="framework-section-react" --skip-other-sections
```

Available component names with required numbered prefixes:
- `01-hero-section` (NOT just "hero-section")
- `02-features-section` (NOT just "features-section")
- `03-try-jods-section` (NOT just "try-jods-section")
- `04-framework-section-react` (NOT just "framework-section-react")
- `04-framework-section-remix` (NOT just "framework-section-remix")
- `05-remix-section` (NOT just "remix-section")
- `06-compare-section` (NOT just "compare-section")
- `07-footer-section` (NOT just "footer-section")

## <required> Important: Using --skip-other-sections Flag </required>

The `--skip-other-sections` flag is **crucial** when you want to focus on a single component without affecting or capturing other sections:

```bash
# CORRECT: Focus ONLY on the specified target
pnpm docs:design-iterations:count-5 --target="04-framework-section-react" --skip-other-sections

# INCORRECT: Will generate screenshots for ALL sections
pnpm docs:design-iterations:count-5 --target="04-framework-section-react"
```

This is essential to avoid the workflow generating unnecessary files for sections you're not changing.

## AI-Driven Workflow

When a user explicitly requests design iterations, you should:

1. **Understand their target component** and where the code is located:
   - `03-try-jods-section` - Interactive demo section → `docs/src/components/InteractiveDemo.tsx`
   - `01-hero-section` - Main hero section on homepage → `docs/src/components/HeroSection.tsx`
   - `02-features-section` - Features grid on homepage → `docs/src/components/FeaturesSection.tsx`
   - `04-framework-section-react` - React framework comparison → `docs/src/components/FrameworkSection.tsx`
   - `04-framework-section-remix` - Remix framework section → `docs/src/components/FrameworkSectionRemix.tsx`
   - `05-remix-section` - Remix integration section → `docs/src/components/RemixSection.tsx`
   - `06-compare-section` - Library comparison section → `docs/src/components/CompareSection.tsx`
   - `07-footer-section` - Footer section → `docs/src/components/FooterSection.tsx`

2. **First analyze the styling approach** of the component:
   - Determine if it uses CSS modules, global CSS, inline styles, etc.
   - Identify the pattern by looking at imports and className usage
   - Follow that same convention for all styling changes

3. **Then modify the component code** based on design goals:
   - Edit the component's TSX/JSX file to change the structure/layout
   - Update CSS styles to change the visual appearance using the same style approach
   - Implement specific changes to address spacing issues, visual balance, etc.
   - Save changes and wait for React to re-render (45-60 seconds)

4. **Verify changes in browser** and **then capture the iteration screenshot** with:
   ```bash
   # Capture just one iteration after code modifications and browser verification
   pnpm docs:design-iterations:count-1 --target="04-framework-section-react" --prompt="detailed design direction" --skip-other-sections
   ```

5. **Verify screenshot reflects your changes**:
   ```bash
   # Always verify the screenshot before proceeding
   open docs/static/screenshots/unified/04-framework-section-react-light-{timestamp}.png
   ```

6. **Document context** in feedback template:
   ```bash
   # Add detailed notes about design decisions and comparisons to previous iterations
   edit docs/temp/design-iterations/iteration-N/feedback-template.md
   ```

7. **Repeat for each unique design** (usually 3-5 iterations):
   - Make different code changes for each iteration
   - Wait for full rebuild between iterations (45-60 seconds minimum)
   - Verify changes in browser before capturing screenshots
   - Confirm screenshots reflect new design
   - Document context and design decisions
   - Track iteration numbers and timestamps

8. **Run these commands for managing iterations**:
   ```bash
   # Check status of iterations
   pnpm docs:design-iterations:status
   
   # Apply the chosen design
   pnpm docs:design-iterations:apply --iteration=N --target="04-framework-section-react"
   
   # Clean up design artifacts ONLY when explicitly requested
   pnpm docs:design-iterations:cleanup
   ```

9. **<critical> Always provide a structured summary </critical>** to the user about their design iterations:
   ```
   # Design Iterations Summary

   You now have [X] design iterations for the [component] section:

   ## Review Your Designs
   You can find the screenshots at:
   - Light mode: /docs/static/screenshots/unified/04-framework-section-react-light-[timestamp].png
   - Dark mode: /docs/static/screenshots/unified/04-framework-section-react-dark-[timestamp].png
   - Iteration folders: /docs/temp/design-iterations/iteration-[N]/screenshots/

   ## Design Context
   Each iteration has a detailed feedback template with context:
   - /docs/temp/design-iterations/iteration-[N]/feedback-template.md
   - Key differences from previous iterations are documented
   - Timestamps indicate when each design was captured

   ## Apply Your Preferred Design
   Once you've chosen a design, apply it with:
   ```bash
   pnpm docs:design-iterations:apply --iteration=[N] --target="04-framework-section-react"
   ```

   ## Clean Up Artifacts
   ONLY after reviewing and applying your chosen design, clean up with:
   ```bash
   pnpm docs:design-iterations:cleanup
   ```
   ```

## Expected Artifacts

Each design iteration generates these artifacts:

1. **Screenshots in two places**:
   - Primary: `docs/static/screenshots/unified/04-framework-section-react-{light|dark}-{timestamp}.png`
   - Backup: `docs/temp/design-iterations/iteration-N/screenshots/`

2. **Debug HTML** (for inspection):
   - `docs/static/debug/04-framework-section-react-{light|dark}-debug-{timestamp}.html`

3. **Diff files** (for tracking changes):
   - `docs/temp/design-iterations/iteration-N/diff.patch`
   - `docs/temp/possible-diffs/04-framework-section-react-{timestamp}.diff`

4. **Documentation**:
   - `docs/temp/design-iterations/iteration-N/feedback-template.md`
   - `docs/temp/design-iterations/iteration-N/metadata.json`

## <required> Best Practices </required>

1. **Analyze styling approach first** - Match the component's existing styling convention
2. **Modify component code BEFORE each screenshot** - Make changes first, then capture
3. **Wait 45-60 seconds after code changes** - DocuSaurus needs time to rebuild
4. **Verify changes in browser** - Confirm your design updates are visible before capturing
5. **Verify screenshot immediately after capture** - Ensure it shows your new design
6. **Document context and design decisions** - Fill in detailed feedback templates
7. **Use `count-1` for each iteration** - Generate one iteration at a time
8. **Include descriptive prompts** - Use `--prompt="detailed design direction"` 
9. **Track timestamps between iterations** - Note exact time of captures
10. **Compare screenshots across iterations** - Ensure visual differences
11. **Avoid disrupting the development server** - Keep it running between iterations
12. **Always use the `--skip-other-sections` flag** - Focus only on your target
13. **Always use numbered component names** - With number prefixes (e.g., `04-framework-section-react`)
14. **Document your changes** - Fill in the feedback templates with detailed context
15. **Apply chosen designs** - With `docs:design-iterations:apply`
16. **Preserve artifacts until explicitly requested** - Only clean up when user explicitly asks
17. **Check for CSS module files** - If a component uses CSS modules, check for and modify those files too

## Common Issues and Troubleshooting

- **Identical screenshots across iterations**: 
  - Not waiting long enough between design changes
  - DocuSaurus hasn't rebuilt with your changes yet
  - Try waiting at least 45-60 seconds and verify changes in browser
  - Restart dev server with `pnpm start` if changes aren't appearing
  - Check for server errors in terminal
  
- **No visual changes**: 
  - Wait 60+ seconds for DocuSaurus to rebuild
  - Verify changes in browser before capturing screenshot
  - Check browser console for errors
  - Try restarting the dev server with `pnpm start`
  
- **Missing timestamps on files**:
  - Check if the screenshot command completed successfully
  - Look for error messages in the terminal
  - Verify the timestamp format in filenames
  
- **Too many screenshots**: 
  - Make sure to use `--skip-other-sections` flag
  
- **Component not found**: 
  - Check the component name - use numbered prefix format (e.g., `04-framework-section-react`)
  - Simple names without numbers may not work consistently
  
- **Missing screenshots**: 
  - Ensure the docs site is running with `pnpm start`
  - Check terminal for screenshot generation errors
  
- **Apply errors**: 
  - Check for uncommitted changes with `git status`
  
- **Styling inconsistencies**:
  - You're using a different styling approach than the component
  - Analyze the imports and className patterns, then follow them

## Diff Analysis and Patching

For troubleshooting screenshot issues, analyze diff files:

1. **Check diff size and content**:
   ```bash
   # View diff content
   cat docs/temp/design-iterations/iteration-N/diff.patch
   
   # Check diff size
   ls -la docs/temp/design-iterations/iteration-N/diff.patch
   ```

2. **Manual screenshot if automation fails**:
   ```bash
   # If automated screenshots fail to capture changes:
   # 1. Take a manual screenshot of the browser
   # 2. Save it with timestamp in filename
   # 3. Document the timestamp in feedback template
   ```

3. **Force rebuild if needed**:
   ```bash
   # If changes aren't appearing:
   pnpm clean
   pnpm build
   pnpm start
   ```

## DocuSaurus Documentation

For more information on the design iterations workflow, see the [official documentation](https://docs.jods.io/design-iterations/workflow):

- **Component Structure**: Each component has a structured naming system and specific selectors
- **Workflow Process**: Step-by-step process from ideation to implementation
- **Best Practices**: Guidelines for effective design iteration
- **Troubleshooting**: Solutions for common issues

@docs/scripts/design-iterations.mjs
@docs/scripts/screenshot-unified.mjs
@docs/docs/design-iterations/index.md 